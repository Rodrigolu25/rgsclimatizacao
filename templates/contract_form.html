{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrato de Prestação de Serviços - RGS Climatização</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <style>
        .form-group {
            margin-bottom: 1rem;
        }

        .payment-details {
            margin-left: 20px;
            display: none;
        }

        .payment-details.active {
            display: block;
        }

        .legal-highlight {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 10px 0;
        }

        .card-header {
            position: relative;
        }

        .legal-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.8em;
        }

        .signature-line {
            border-top: 1px solid #000;
            width: 200px;
            margin-top: 50px;
        }

        .section-title {
            background-color: #f8f9fa;
            padding: 8px;
            border-left: 4px solid #0d6efd;
            margin-bottom: 15px;
        }

        .currency-input {
            position: relative;
        }

        .currency-input::before {
            content: "R$";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

        .currency-input input {
            padding-left: 30px;
        }

        .legal-reference {
            font-size: 0.8em;
            color: #666;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="alert alert-success" role="alert">
            <h4 class="alert-heading">✅ Contrato Juridicamente Aprimorado</h4>
            <p>Este contrato foi atualizado com as melhorias previstas na legislação brasileira para maior segurança
                jurídica.</p>
        </div>

        <h1 class="mt-4">Contrato de Prestação de Serviços - RGS Climatização</h1>

        <!-- Formulário principal -->
        <form id="contractForm">
            <!-- Seção 1: Dados das Partes -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Dados das Partes</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 104 CC</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Contratante</h3>
                            <div class="form-group">
                                <label for="client_name">Nome:</label>
                                <input type="text" class="form-control" id="client_name" name="client_name" required>
                            </div>
                            <div class="form-group">
                                <label for="client_cpf_cnpj">CPF/CNPJ:</label>
                                <input type="text" class="form-control" id="client_cpf_cnpj" name="client_cpf_cnpj"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="client_address">Endereço:</label>
                                <input type="text" class="form-control" id="client_address" name="client_address"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="client_phone">Telefone:</label>
                                <input type="text" class="form-control" id="client_phone" name="client_phone" required>
                            </div>
                            <div class="form-group">
                                <label for="client_email">E-mail:</label>
                                <input type="email" class="form-control" id="client_email" name="client_email">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3>Contratado</h3>
                            <div class="form-group">
                                <label for="contractor_business_name">Nome Empresarial:</label>
                                <input type="text" class="form-control" id="contractor_business_name"
                                    name="contractor_business_name" value="RGS Climatização" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_owner">Titular:</label>
                                <input type="text" class="form-control" id="contractor_owner" name="contractor_owner"
                                    value="Rodrigo Gonçalves de Souza" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_cnpj">CNPJ:</label>
                                <input type="text" class="form-control" id="contractor_cnpj" name="contractor_cnpj"
                                    value="61.038.796/0001-66" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_address">Endereço:</label>
                                <input type="text" class="form-control" id="contractor_address"
                                    name="contractor_address" value="Rua Carijós, 52, Filadélfia – Teófilo Otoni/MG"
                                    readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_phone">Telefone:</label>
                                <input type="text" class="form-control" id="contractor_phone" name="contractor_phone"
                                    value="(33) 98827-3510" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_email">E-mail:</label>
                                <input type="email" class="form-control" id="contractor_email" name="contractor_email"
                                    value="rgs.climatizacao.to@gmail.com" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 2: Objeto do Contrato -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cláusula 1 - Do Objeto</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 593 CC</span>
                </div>
                <div class="card-body">
                    <p>O presente contrato tem por objeto a prestação dos seguintes serviços relacionados a aparelhos de
                        ar-condicionado:</p>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_installation" name="services"
                            value="Instalação" checked>
                        <label class="form-check-label" for="service_installation">Instalação</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_preventive" name="services"
                            value="Manutenção preventiva" checked>
                        <label class="form-check-label" for="service_preventive">Manutenção preventiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_corrective" name="services"
                            value="Manutenção corretiva" checked>
                        <label class="form-check-label" for="service_corrective">Manutenção corretiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_cleaning" name="services"
                            value="Limpeza técnica/higienização" checked>
                        <label class="form-check-label" for="service_cleaning">Limpeza técnica/higienização</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_other" name="services"
                            value="Outros">
                        <label class="form-check-label" for="service_other">Outros:</label>
                        <input type="text" class="form-control mt-2" id="other_service" name="other_service">
                    </div>
                </div>
            </div>

            <!-- Seção 3: Local e Prazo -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cláusula 2 - Do Local e Prazo</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 594 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="service_location">Local de prestação dos serviços:</label>
                        <input type="text" class="form-control" id="service_location" name="service_location"
                            value="Teófilo Otoni/MG" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="start_date">Data de início:</label>
                                <input type="date" class="form-control" id="start_date" name="start_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="end_date">Data de término prevista:</label>
                                <input type="date" class="form-control" id="end_date" name="end_date" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="renewal_clause" name="renewal_clause"
                            checked>
                        <label class="form-check-label" for="renewal_clause">Incluir cláusula de renovação automática
                            por iguais períodos sucessivos</label>
                    </div>
                </div>
            </div>

            <!-- Seção 4: Valor e Pagamento -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cláusula 3 - Do Valor e Forma de Pagamento</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 315 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group currency-input">
                        <label for="service_value">Valor total do serviço:</label>
                        <input type="text" class="form-control" id="service_value" name="service_value" required>
                    </div>
                    <div class="form-group">
                        <label>Forma de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_cash"
                                value="À vista" checked>
                            <label class="form-check-label" for="payment_cash">À vista</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_installment"
                                value="Parcelado">
                            <label class="form-check-label" for="payment_installment">Parcelado</label>
                            <div class="payment-details" id="installment_details">
                                <label>em <input type="number" class="form-control-sm" id="installments"
                                        name="installments" min="2" max="12" style="width: 60px;"> vezes de R$ <input
                                        type="text" class="form-control-sm" id="installment_value"
                                        name="installment_value" style="width: 80px;"></label>
                            </div>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_downpayment"
                                value="Sinal">
                            <label class="form-check-label" for="payment_downpayment">Sinal</label>
                            <div class="payment-details" id="downpayment_details">
                                <label>de R$ <input type="text" class="form-control-sm" id="downpayment"
                                        name="downpayment" style="width: 80px;"> na assinatura e o restante após
                                    conclusão</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <label>Método de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_pix"
                                value="Pix" checked>
                            <label class="form-check-label" for="payment_pix">Pix</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_money"
                                value="Dinheiro">
                            <label class="form-check-label" for="payment_money">Dinheiro</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_transfer"
                                value="Transferência bancária">
                            <label class="form-check-label" for="payment_transfer">Transferência bancária</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_other_type"
                                value="Outros">
                            <label class="form-check-label" for="payment_other_type">Outros:</label>
                            <input type="text" class="form-control-sm ml-2" id="other_payment" name="other_payment"
                                style="width: 150px;">
                        </div>
                    </div>

                    <div class="legal-highlight mt-3">
                        <strong>📅 Prazo para Reclamação:</strong> Conforme CDC Art. 26
                        <div class="form-group mt-2">
                            <label for="complaint_period">Prazo para comunicar problemas (dias úteis):</label>
                            <select class="form-control" id="complaint_period" name="complaint_period">
                                <option value="5">5 dias úteis</option>
                                <option value="7">7 dias úteis</option>
                                <option value="10">10 dias úteis</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 5: Multa e Penalidades -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Cláusula 4 - Das Penalidades</h2>
                    <span class="badge bg-dark text-light legal-badge">Art. 408 CC</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>⚖️ Multa por Inadimplemento</strong>
                        <p>Conforme Código Civil, Art. 408-410</p>
                    </div>
                    <div class="form-group">
                        <label for="penalty_percentage">Percentual da multa por descumprimento:</label>
                        <select class="form-control" id="penalty_percentage" name="penalty_percentage">
                            <option value="10">10% sobre o valor do contrato</option>
                            <option value="15">15% sobre o valor do contrato</option>
                            <option value="20">20% sobre o valor do contrato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="late_fee">Taxa de mora por atraso no pagamento (% ao mês):</label>
                        <select class="form-control" id="late_fee" name="late_fee">
                            <option value="1">1% ao mês</option>
                            <option value="2">2% ao mês</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attorney_fees">Honorários advocatícios em caso de cobrança judicial:</label>
                        <select class="form-control" id="attorney_fees" name="attorney_fees">
                            <option value="10">10%</option>
                            <option value="20" selected>20%</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Seção 6: Garantia Detalhada -->
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h2>Cláusula 5 - Da Garantia</h2>
                    <span class="badge bg-light text-dark legal-badge">CDC Art. 26</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>🛡️ Garantia Legal Ampliada</strong>
                        <p>Baseada no Código de Defesa do Consumidor</p>
                    </div>
                    <div class="form-group">
                        <label for="warranty_period">Período de garantia:</label>
                        <select class="form-control" id="warranty_period" name="warranty_period">
                            <option value="90">90 dias (padrão)</option>
                            <option value="180">180 dias</option>
                            <option value="365">1 ano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>O que está coberto pela garantia:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_execution"
                                name="warranty_coverage" value="Defeitos de execução" checked>
                            <label class="form-check-label" for="warranty_execution">Defeitos de execução</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_materials"
                                name="warranty_coverage" value="Materiais defeituosos" checked>
                            <label class="form-check-label" for="warranty_materials">Materiais defeituosos</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_installation"
                                name="warranty_coverage" value="Problemas de instalação" checked>
                            <label class="form-check-label" for="warranty_installation">Problemas de instalação</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>O que NÃO está coberto:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_misuse"
                                name="warranty_exclusions" value="Mau uso" checked>
                            <label class="form-check-label" for="exclusion_misuse">Mau uso pelo cliente</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_third_party"
                                name="warranty_exclusions" value="Interferência de terceiros" checked>
                            <label class="form-check-label" for="exclusion_third_party">Interferência de
                                terceiros</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_electrical"
                                name="warranty_exclusions" value="Problemas elétricos" checked>
                            <label class="form-check-label" for="exclusion_electrical">Problemas elétricos
                                externos</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 7: Limitação de Responsabilidade -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h2>Cláusula 6 - Da Limitação de Responsabilidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Jurisprudência</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>🛡️ Proteção Jurídica</strong>
                        <p>Limitação baseada em jurisprudência consolidada</p>
                    </div>
                    <div class="form-group">
                        <label>A contratada NÃO se responsabiliza por:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_electrical"
                                name="liability_limitations" value="Falhas elétricas" checked>
                            <label class="form-check-label" for="limit_electrical">Falhas elétricas da rede
                                local</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_structural"
                                name="liability_limitations" value="Problemas estruturais" checked>
                            <label class="form-check-label" for="limit_structural">Problemas estruturais do
                                imóvel</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_indirect"
                                name="liability_limitations" value="Danos indiretos" checked>
                            <label class="form-check-label" for="limit_indirect">Danos indiretos ou lucros
                                cessantes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_acts" name="liability_limitations"
                                value="Atos de terceiros" checked>
                            <label class="form-check-label" for="limit_acts">Atos de terceiros não autorizados</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 8: Confidencialidade -->
            <div class="card mt-4">
                <div class="card-header bg-secondary text-white">
                    <h2>Cláusula 7 - Da Confidencialidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Livre Pacto</span>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confidentiality_clause"
                            name="confidentiality_clause" value="true" checked>
                        <label class="form-check-label" for="confidentiality_clause">
                            <strong>Incluir cláusula de confidencialidade</strong><br>
                            <small class="text-muted">Proteção de dados e informações sensíveis de ambas as
                                partes</small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Seção 9: Rescisão -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h2>Cláusula 8 - Da Rescisão</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 473 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="termination_notice">Prazo para comunicação de rescisão (dias):</label>
                        <input type="number" class="form-control" id="termination_notice" name="termination_notice"
                            value="30">
                    </div>
                    <div class="form-group">
                        <label for="termination_penalty">Multa por rescisão unilateral injustificada:</label>
                        <select class="form-control" id="termination_penalty" name="termination_penalty">
                            <option value="20">20% do valor do contrato</option>
                            <option value="30">30% do valor do contrato</option>
                            <option value="50" selected>50% do valor dos serviços não executados</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="termination_settlement">Prazo para acerto de contas após rescisão (dias):</label>
                        <input type="number" class="form-control" id="termination_settlement"
                            name="termination_settlement" value="10">
                    </div>
                </div>
            </div>

            <!-- Seção 10: Disposições Gerais -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cláusula 9 - Das Disposições Gerais</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="jurisdiction">Foro para resolução de disputas:</label>
                        <input type="text" class="form-control" id="jurisdiction" name="jurisdiction"
                            value="Teófilo Otoni/MG">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="successors_clause" name="successors_clause"
                            checked>
                        <label class="form-check-label" for="successors_clause">
                            O contrato obriga sucessores e herdeiros
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="written_modification"
                            name="written_modification" checked>
                        <label class="form-check-label" for="written_modification">
                            Alterações devem ser feitas por escrito
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="official_communication"
                            name="official_communication" checked>
                        <label class="form-check-label" for="official_communication">
                            Comunicações oficiais por e-mail ou correspondência com AR
                        </label>
                    </div>
                </div>
            </div>

            <!-- Seção 11: Testemunhas -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Testemunhas</h2>
                    <span class="badge bg-dark text-light legal-badge">CPC Art. 784</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>⚖️ Execução Judicial Facilitada</strong>
                        <p>Contrato com duas testemunhas permite execução mais rápida (CPC Art. 784, III)</p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Testemunha 1</h5>
                            <div class="form-group">
                                <label for="witness1_name">Nome:</label>
                                <input type="text" class="form-control" id="witness1_name" name="witness1_name"
                                    value="Rodrigo Souza">
                            </div>
                            <div class="form-group">
                                <label for="witness1_cpf">CPF:</label>
                                <input type="text" class="form-control" id="witness1_cpf" name="witness1_cpf"
                                    value="016.049.496-60">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>Testemunha 2</h5>
                            <div class="form-group">
                                <label for="witness2_name">Nome:</label>
                                <input type="text" class="form-control" id="witness2_name" name="witness2_name"
                                    value="Luciana Seixas de Almeida">
                            </div>
                            <div class="form-group">
                                <label for="witness2_cpf">CPF:</label>
                                <input type="text" class="form-control" id="witness2_cpf" name="witness2_cpf"
                                    value="054.960.656-40">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 12: Termos e Condições -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Termos e Condições</h2>
                </div>
                <div class="card-body">
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="agree_terms" name="agree_terms" required>
                        <label class="form-check-label" for="agree_terms">
                            <strong>Concordo com todos os termos e condições deste contrato juridicamente
                                aprimorado</strong>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Botão para gerar PDF -->
            <div class="mt-4 mb-4">
                <button type="button" id="generatePdfBtn" class="btn btn-success btn-lg">
                    📄 Gerar Contrato Juridicamente Aprimorado em PDF
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Máscaras para os campos
            $('#client_cpf_cnpj').mask('000.000.000-00', { reverse: true });
            $('#client_phone').mask('(00) 00000-0000');
            $('#witness1_cpf, #witness2_cpf').mask('000.000.000-00');

            // Máscara para valores monetários
            $('.currency-input input').mask('#.##0,00', { reverse: true });
            $('#installment_value, #downpayment').mask('#.##0,00', { reverse: true });

            // Configurar data inicial padrão para hoje
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = formattedDate;

            // Configurar data final padrão para 13 meses depois
            const endDate = new Date(today);
            endDate.setMonth(endDate.getMonth() + 13);
            const formattedEndDate = endDate.toISOString().split('T')[0];
            document.getElementById('end_date').value = formattedEndDate;

            // Controle dos campos de pagamento
            const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
            const installmentDetails = document.getElementById('installment_details');
            const downpaymentDetails = document.getElementById('downpayment_details');

            paymentMethods.forEach(method => {
                method.addEventListener('change', function () {
                    installmentDetails.classList.remove('active');
                    downpaymentDetails.classList.remove('active');

                    if (this.value === 'Parcelado') {
                        installmentDetails.classList.add('active');
                    } else if (this.value === 'Sinal') {
                        downpaymentDetails.classList.add('active');
                    }
                });
            });

            // Calcular valor da parcela quando o número de parcelas ou valor total mudar
            $('#installments, #service_value').on('change', function () {
                const totalValue = parseFloat($('#service_value').val().replace('.', '').replace(',', '.'));
                const installments = parseInt($('#installments').val());

                if (totalValue && installments) {
                    const installmentValue = totalValue / installments;
                    $('#installment_value').val(installmentValue.toFixed(2).replace('.', ','));
                }
            });

            // Gerar PDF
            document.getElementById('generatePdfBtn').addEventListener('click', function () {
                const form = document.getElementById('contractForm');

                if (!form.checkValidity()) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }

                if (!document.getElementById('agree_terms').checked) {
                    alert('Você deve concordar com os termos e condições para gerar o contrato.');
                    return;
                }

                generatePDF();
            });

            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');

                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const maxWidth = pageWidth - (margin * 2);
                let currentY = margin;

                // Configurações de estilo
                const styles = {
                    title: { fontSize: 16, fontStyle: 'bold', textColor: [0, 0, 0] },
                    subtitle: { fontSize: 14, fontStyle: 'bold', textColor: [0, 0, 0] },
                    sectionTitle: { fontSize: 12, fontStyle: 'bold', textColor: [13, 110, 253] },
                    normal: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] },
                    highlight: { fontSize: 10, fontStyle: 'bold', textColor: [0, 100, 0] },
                    legal: { fontSize: 9, fontStyle: 'italic', textColor: [100, 100, 100] },
                    center: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] }
                };

                // Função para adicionar texto com quebra de linha automática
                function addText(text, style, isNewPage = false, isCenter = false) {
                    if (isNewPage || currentY > pageHeight - 30) {
                        doc.addPage();
                        currentY = margin;
                    }

                    doc.setFontSize(style.fontSize);
                    doc.setFont('helvetica', style.fontStyle);
                    doc.setTextColor(style.textColor[0], style.textColor[1], style.textColor[2]);

                    const lines = doc.splitTextToSize(text, maxWidth);
                    lines.forEach(line => {
                        if (currentY > pageHeight - 20) {
                            doc.addPage();
                            currentY = margin;
                        }

                        const xPosition = isCenter ? pageWidth / 2 : margin;
                        const alignment = isCenter ? 'center' : 'left';
                        doc.text(line, xPosition, currentY, { align: alignment });
                        currentY += style.fontSize * 0.5;
                    });
                    currentY += 3;
                }

                // Função para adicionar seção
                function addSection(title, content, legalRef = '') {
                    addText(title + (legalRef ? ` (${legalRef})` : ''), styles.sectionTitle);
                    currentY += 2;
                    addText(content, styles.normal);
                    currentY += 5;
                }

                // Cabeçalho do contrato
                addText('CONTRATO DE PRESTAÇÃO DE SERVIÇOS', styles.title, false, true);
                addText('RGS CLIMATIZAÇÃO', styles.subtitle, false, true);
                currentY += 5;

                // Dados das partes
                const clientName = document.getElementById('client_name')?.value || '[NOME DO CLIENTE]';
                const clientCpfCnpj = document.getElementById('client_cpf_cnpj')?.value || '[CPF/CNPJ]';
                const clientAddress = document.getElementById('client_address')?.value || '[ENDEREÇO]';
                const clientPhone = document.getElementById('client_phone')?.value || '[TELEFONE]';
                const clientEmail = document.getElementById('client_email')?.value || '';

                addSection('DADOS DAS PARTES',
                    `CONTRATANTE: ${clientName}, CPF/CNPJ: ${clientCpfCnpj}, Endereço: ${clientAddress}, Telefone: ${clientPhone}${clientEmail ? ', E-mail: ' + clientEmail : ''}\n\n` +
                    `CONTRATADO: RGS Climatização, Titular: Rodrigo Gonçalves de Souza, CNPJ: 61.038.796/0001-66, Endereço: Rua Carijós, 52, Filadélfia – Teófilo Otoni/MG, Telefone: (33) 98827-3510, E-mail: rgs.climatizacao.to@gmail.com`,
                    'Art. 104 CC');

                // Objeto do contrato
                const services = [];
                const serviceElements = document.querySelectorAll('input[name="services"]:checked');
                serviceElements.forEach(service => {
                    if (service.value === 'Outros' && document.getElementById('other_service')?.value) {
                        services.push(document.getElementById('other_service').value);
                    } else if (service.value !== 'Outros') {
                        services.push(service.value);
                    }
                });

                if (services.length === 0) {
                    services.push('[SERVIÇOS A SEREM DEFINIDOS]');
                }

                addSection('CLÁUSULA PRIMEIRA - DO OBJETO',
                    `O presente contrato tem por objeto a prestação de serviços técnicos relacionados a aparelhos de ar-condicionado, compreendendo os seguintes serviços:\n\n` +
                    services.map((service, index) => `${String.fromCharCode(97 + index)}) ${service}`).join('\n'),
                    'Art. 593 CC');

                // Local e prazo
                const serviceLocation = document.getElementById('service_location')?.value || '[LOCAL]';
                const startDate = document.getElementById('start_date')?.value || new Date().toISOString().split('T')[0];
                const endDate = document.getElementById('end_date')?.value || new Date().toISOString().split('T')[0];
                const renewalClause = document.getElementById('renewal_clause')?.checked || false;

                const startDateFormatted = new Date(startDate).toLocaleDateString('pt-BR');
                const endDateFormatted = new Date(endDate).toLocaleDateString('pt-BR');

                addSection('CLÁUSULA SEGUNDA - DO LOCAL E PRAZO DE EXECUÇÃO',
                    `1. Os serviços serão executados no município de ${serviceLocation}, podendo ser realizados em outros locais mediante prévia concordância por escrito entre as partes.\n\n` +
                    `2. O início da execução dos serviços será em ${startDateFormatted}, com término previsto para ${endDateFormatted}` +
                    (renewalClause ? ', podendo ser renovado por mútuo acordo, mediante Termo Aditivo.' : '.') + '\n\n' +
                    `3. O presente contrato poderá ser prorrogado mediante acordo expresso entre as partes, formalizado por meio de Termo Aditivo.`,
                    'Art. 594 CC');

                // Valor e pagamento
                const serviceValue = document.getElementById('service_value')?.value || '[VALOR]';
                const paymentMethodEl = document.querySelector('input[name="payment_method"]:checked');
                const paymentTypeEl = document.querySelector('input[name="payment_type"]:checked');
                const complaintPeriod = document.getElementById('complaint_period')?.value || '7';

                const paymentMethod = paymentMethodEl ? paymentMethodEl.value : 'À vista';
                const paymentType = paymentTypeEl ? paymentTypeEl.value : 'Dinheiro';

                let paymentDetails = `1. O valor total dos serviços ora contratados é de R$ ${serviceValue}.\n\n`;

                if (paymentMethod === 'À vista') {
                    paymentDetails += `2. O pagamento será efetuado à vista`;
                } else if (paymentMethod === 'Parcelado') {
                    const installments = document.getElementById('installments')?.value || '[PARCELAS]';
                    const installmentValue = document.getElementById('installment_value')?.value || '[VALOR PARCELA]';
                    paymentDetails += `2. O pagamento será efetuado parcelado em ${installments} vezes de R$ ${installmentValue}`;
                } else if (paymentMethod === 'Sinal') {
                    const downpayment = document.getElementById('downpayment')?.value || '[SINAL]';
                    paymentDetails += `2. O pagamento será efetuado com sinal de R$ ${downpayment} na assinatura e o restante após conclusão`;
                }

                if (paymentType === 'Pix') {
                    paymentDetails += `, por meio de transferência via Pix, para a conta informada pelo Contratado.\n\n`;
                } else if (paymentType === 'Outros') {
                    const otherPayment = document.getElementById('other_payment')?.value || '[FORMA DE PAGAMENTO]';
                    paymentDetails += `, por meio de ${otherPayment}.\n\n`;
                } else {
                    paymentDetails += `, por meio de ${paymentType}.\n\n`;
                }

                paymentDetails += `3. O prazo máximo para comunicação de eventuais problemas ou defeitos detectados na execução dos serviços é de ${complaintPeriod} dias úteis após sua conclusão.\n\n`;
                paymentDetails += `4. Os valores poderão ser reajustados anualmente pelo Índice Nacional de Preços ao Consumidor Amplo (IPCA), ou na falta deste, por índice que o substitua.`;

                addSection('CLÁUSULA TERCEIRA - DO VALOR E FORMA DE PAGAMENTO', paymentDetails, 'Art. 315 CC / Lei 10.192/01');

                // Penalidades
                const penaltyPercentage = document.getElementById('penalty_percentage')?.value || '10';
                const lateFee = document.getElementById('late_fee')?.value || '2';

                addSection('CLÁUSULA QUARTA - DAS PENALIDADES',
                    `1. Em caso de descumprimento de qualquer obrigação estabelecida neste contrato, aplicar-se-á multa de ${penaltyPercentage}% sobre o valor total pactuado, independentemente de outras sanções legais.\n\n` +
                    `2. Caso o Contratante atrase o pagamento, incidirá taxa de mora de ${lateFee}% ao mês sobre o valor devido, sem prejuízo da cobrança judicial, se necessário.\n\n` +
                    `3. A aplicação das penalidades previstas nesta cláusula não exime as partes do cumprimento de suas obrigações contratuais.`,
                    'Art. 408 CC');

                // Garantia
                const warrantyPeriod = document.getElementById('warranty_period')?.value || '90';
                const warrantyCoverage = [];
                const warrantyCoverageElements = document.querySelectorAll('input[name="warranty_coverage"]:checked');
                warrantyCoverageElements.forEach(item => {
                    warrantyCoverage.push(item.value);
                });

                const warrantyExclusions = [];
                const warrantyExclusionsElements = document.querySelectorAll('input[name="warranty_exclusions"]:checked');
                warrantyExclusionsElements.forEach(item => {
                    warrantyExclusions.push(item.value);
                });

                if (warrantyCoverage.length === 0) {
                    warrantyCoverage.push('Serviços executados conforme especificação técnica');
                }
                if (warrantyExclusions.length === 0) {
                    warrantyExclusions.push('Danos decorrentes de mau uso ou negligência');
                }

                addSection('CLÁUSULA QUINTA - DA GARANTIA',
                    `1. O Contratado oferece garantia de ${warrantyPeriod} dias contados da data de conclusão dos serviços, responsabilizando-se pelos vícios e defeitos decorrentes da execução.\n\n` +
                    `2. A garantia cobre especificamente:\n` +
                    warrantyCoverage.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `3. Ficam expressamente excluídos da garantia:\n` +
                    warrantyExclusions.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `4. Para fazer valer a garantia, o Contratante deverá comunicar os defeitos por escrito, dentro do prazo estabelecido no item 1.`,
                    'CDC Art. 26');

                // Limitação de responsabilidade
                const liabilityLimitations = [];
                const liabilityElements = document.querySelectorAll('input[name="liability_limitations"]:checked');
                liabilityElements.forEach(item => {
                    liabilityLimitations.push(item.value);
                });

                if (liabilityLimitations.length === 0) {
                    liabilityLimitations.push('Danos indiretos ou lucros cessantes');
                }

                addSection('CLÁUSULA SEXTA - DA LIMITAÇÃO DE RESPONSABILIDADE',
                    `1. O Contratado não se responsabiliza por:\n\n` +
                    liabilityLimitations.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `2. A limitação de responsabilidade prevista nesta cláusula não se aplica aos casos de dolo ou culpa grave do Contratado.\n\n` +
                    `3. O Contratado se compromete a executar os serviços com a diligência e técnica adequadas, observando as normas de segurança aplicáveis.`,
                    'Art. 944 CC / Jurisprudência');

                // Confidencialidade
                const confidentialityClause = document.getElementById('confidentiality_clause')?.checked || false;
                if (confidentialityClause) {
                    addSection('CLÁUSULA SÉTIMA - DA CONFIDENCIALIDADE',
                        `1. As partes comprometem-se a manter sigilo absoluto sobre todas as informações trocadas durante a vigência deste contrato, especialmente aquelas que sejam consideradas confidenciais ou estratégicas.\n\n` +
                        `2. A obrigação de confidencialidade permanece válida mesmo após o término do presente contrato.\n\n` +
                        `3. O descumprimento desta cláusula sujeitará a parte infratora ao pagamento de indenização por danos morais e materiais.`,
                        'Art. 421 CC / Livre Pactuação');
                }

                // Rescisão
                const terminationNotice = document.getElementById('termination_notice')?.value || '30';
                const terminationPenalty = document.getElementById('termination_penalty')?.value || '10';

                addSection('CLÁUSULA OITAVA - DA RESCISÃO',
                    `1. Este contrato poderá ser rescindido antecipadamente nas seguintes hipóteses:\n\n` +
                    `a) Por descumprimento de qualquer cláusula essencial deste contrato;\n` +
                    `b) Por mútuo acordo entre as partes, mediante Termo Aditivo específico;\n` +
                    `c) Por impossibilidade superveniente de cumprimento das obrigações contratuais;\n` +
                    `d) Por falência, concordata, dissolução ou liquidação de qualquer das partes;\n` +
                    `e) Por força maior ou caso fortuito que impossibilite a continuidade da relação contratual.\n\n` +
                    `2. Na hipótese de rescisão por descumprimento contratual, a parte inadimplente pagará à outra indenização correspondente aos prejuízos efetivamente sofridos.\n\n` +
                    `3. Em caso de rescisão unilateral imotivada, a parte que der causa pagará indenização proporcional pelos serviços já realizados e despesas incorridas.\n\n` +
                    `4. A rescisão não exime as partes do cumprimento das obrigações vencidas até a data da extinção do contrato.`,
                    'Art. 473 e 475 CC');

                // Disposições gerais
                const jurisdiction = document.getElementById('jurisdiction')?.value || 'Teófilo Otoni/MG';
                addSection('CLÁUSULA NONA - DAS DISPOSIÇÕES GERAIS',
                    `1. Este contrato entra em vigor na data de sua assinatura e produz efeitos por todo o período pactuado, vinculando as partes e seus sucessores a título universal.\n\n` +
                    `2. Qualquer alteração ou modificação deste contrato deverá ser feita por escrito, mediante Termo Aditivo assinado por ambas as partes.\n\n` +
                    `3. As comunicações entre as partes poderão ocorrer por meio de e-mail, WhatsApp, telefone ou correspondência registrada, utilizando-se os dados de contato constantes no preâmbulo deste instrumento.\n\n` +
                    `4. O presente contrato obriga não só as partes que o subscrevem, como também seus herdeiros e sucessores.\n\n` +
                    `5. Se qualquer disposição deste contrato for considerada inválida ou inexequível, as demais cláusulas permanecerão em pleno vigor.\n\n` +
                    `6. Este contrato é regido pelas leis brasileiras, especialmente pelo Código Civil e Código de Defesa do Consumidor, quando aplicável.\n\n` +
                    `7. As partes elegem o foro da comarca de ${jurisdiction} para dirimir quaisquer questões oriundas deste contrato, com renúncia expressa a qualquer outro, por mais privilegiado que seja.`,
                    'Art. 104 e 421 CC');

                // *** FORÇA A SEGUNDA PÁGINA AQUI ***
                // Adiciona nova página para as assinaturas e testemunhas
                doc.addPage();
                currentY = margin;
                
                // Testemunhas na segunda página
                const witness1Name = document.getElementById('witness1_name')?.value || '[NOME TESTEMUNHA 1]';
                const witness1Cpf = document.getElementById('witness1_cpf')?.value || '[CPF TESTEMUNHA 1]';
                const witness2Name = document.getElementById('witness2_name')?.value || '[NOME TESTEMUNHA 2]';
                const witness2Cpf = document.getElementById('witness2_cpf')?.value || '[CPF TESTEMUNHA 2]';

                addSection('TESTEMUNHAS',
                    `___________________________________________________________\n` +
                    `1ª Testemunha: ${witness1Name}, CPF: ${witness1Cpf}\n` +
                    `Assinatura\n\n\n` +
                    `___________________________________________________________\n` +
                    `2ª Testemunha: ${witness2Name}, CPF: ${witness2Cpf}\n` +
                    `Assinatura`,
                    'CPC Art. 784');
                

                // Data e local na segunda página
                const today = new Date().toLocaleDateString('pt-BR');
                addText(`${serviceLocation}, ${today}`, styles.normal);
                currentY += 10;

                // Linhas de assinatura do CONTRATANTE e CONTRATADO na segunda página
                addText('_'.repeat(50), styles.normal, false, true);
                addText('CONTRATANTE', styles.normal, false, true);
                currentY += 15;

                addText('_'.repeat(50), styles.normal, false, true);
                addText('CONTRATADO - RGS Climatização', styles.normal, false, true);
                addText('Rodrigo Gonçalves de Souza', styles.normal, false, true);
                currentY += 20;

                

                // Salvar PDF
                const fileName = `Contrato_RGS_${clientName.replace(/\s+/g, '_')}_${today.replace(/\//g, '-')}.pdf`;
                doc.save(fileName);

                alert('✅ Contrato gerado com sucesso!');
            }
        });
    </script>
</body>

</html>
{% endblock %}