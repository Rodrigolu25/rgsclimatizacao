{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrato de Presta√ß√£o de Servi√ßos - RGS Climatiza√ß√£o</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .form-group {
            margin-bottom: 1rem;
        }
        .payment-details {
            margin-left: 20px;
            display: none;
        }
        .payment-details.active {
            display: block;
        }
        .legal-highlight {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 10px 0;
        }
        .card-header {
            position: relative;
        }
        .legal-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.8em;
        }
        .signature-line {
            border-top: 1px solid #000;
            width: 200px;
            margin-top: 50px;
        }
        .section-title {
            background-color: #f8f9fa;
            padding: 8px;
            border-left: 4px solid #0d6efd;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="alert alert-success" role="alert">
            <h4 class="alert-heading">‚úÖ Contrato Juridicamente Aprimorado</h4>
            <p>Este contrato foi atualizado com as melhorias previstas na legisla√ß√£o brasileira para maior seguran√ßa jur√≠dica.</p>
        </div>
        
        <h1 class="mt-4">Contrato de Presta√ß√£o de Servi√ßos - RGS Climatiza√ß√£o</h1>
        
        <!-- Formul√°rio principal -->
        <form id="contractForm">
            <!-- Se√ß√£o 1: Dados das Partes -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Dados das Partes</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 104 CC</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Contratante</h3>
                            <div class="form-group">
                                <label for="client_name">Nome:</label>
                                <input type="text" class="form-control" id="client_name" name="client_name" required>
                            </div>
                            <div class="form-group">
                                <label for="client_cpf_cnpj">CPF/CNPJ:</label>
                                <input type="text" class="form-control" id="client_cpf_cnpj" name="client_cpf_cnpj" required>
                            </div>
                            <div class="form-group">
                                <label for="client_address">Endere√ßo:</label>
                                <input type="text" class="form-control" id="client_address" name="client_address" required>
                            </div>
                            <div class="form-group">
                                <label for="client_phone">Telefone:</label>
                                <input type="text" class="form-control" id="client_phone" name="client_phone" required>
                            </div>
                            <div class="form-group">
                                <label for="client_email">E-mail:</label>
                                <input type="email" class="form-control" id="client_email" name="client_email">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3>Contratado</h3>
                            <p><strong>Nome Empresarial:</strong> RGS Climatiza√ß√£o</p>
                            <p><strong>Titular:</strong> Rodrigo Gon√ßalves de Souza</p>
                            <p><strong>CNPJ:</strong> 61.038.796/0001-66</p>
                            <p><strong>Endere√ßo:</strong> Rua Carij√≥s, 52, Filad√©lfia ‚Äì Te√≥filo Otoni/MG</p>
                            <p><strong>Telefone:</strong> (33) 98827-3510</p>
                            <p><strong>E-mail:</strong> rgs.climatizacao.to@gmail.com</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Objeto do Contrato -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 1 - Do Objeto</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 593 CC</span>
                </div>
                <div class="card-body">
                    <p>O presente contrato tem por objeto a presta√ß√£o dos seguintes servi√ßos relacionados a aparelhos de ar-condicionado:</p>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_installation" name="services" value="Instala√ß√£o">
                        <label class="form-check-label" for="service_installation">Instala√ß√£o</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_preventive" name="services" value="Manuten√ß√£o preventiva">
                        <label class="form-check-label" for="service_preventive">Manuten√ß√£o preventiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_corrective" name="services" value="Manuten√ß√£o corretiva">
                        <label class="form-check-label" for="service_corrective">Manuten√ß√£o corretiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_cleaning" name="services" value="Limpeza t√©cnica/higieniza√ß√£o">
                        <label class="form-check-label" for="service_cleaning">Limpeza t√©cnica/higieniza√ß√£o</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_other" name="services" value="Outros">
                        <label class="form-check-label" for="service_other">Outros:</label>
                        <input type="text" class="form-control mt-2" id="other_service" name="other_service">
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 3: Local e Prazo -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 2 - Do Local e Prazo</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 594 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="service_location">Local de presta√ß√£o dos servi√ßos:</label>
                        <input type="text" class="form-control" id="service_location" name="service_location" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="start_date">Data de in√≠cio:</label>
                                <input type="date" class="form-control" id="start_date" name="start_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="end_date">Data de t√©rmino prevista:</label>
                                <input type="date" class="form-control" id="end_date" name="end_date" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 4: Valor e Pagamento -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 3 - Do Valor e Forma de Pagamento</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 315 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="service_value">Valor total do servi√ßo (R$):</label>
                        <input type="number" step="0.01" class="form-control" id="service_value" name="service_value" required>
                    </div>
                    <div class="form-group">
                        <label>Forma de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_cash" value="√Ä vista" required>
                            <label class="form-check-label" for="payment_cash">√Ä vista</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_installment" value="Parcelado">
                            <label class="form-check-label" for="payment_installment">Parcelado</label>
                            <div class="payment-details" id="installment_details">
                                <label>em <input type="number" class="form-control-sm" id="installments" name="installments" min="2" max="12" style="width: 60px;"> vezes de R$ <input type="number" step="0.01" class="form-control-sm" id="installment_value" name="installment_value" style="width: 80px;"></label>
                            </div>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_downpayment" value="Sinal">
                            <label class="form-check-label" for="payment_downpayment">Sinal</label>
                            <div class="payment-details" id="downpayment_details">
                                <label>de R$ <input type="number" step="0.01" class="form-control-sm" id="downpayment" name="downpayment" style="width: 80px;"> na assinatura e o restante ap√≥s conclus√£o</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <label>M√©todo de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_pix" value="Pix" required>
                            <label class="form-check-label" for="payment_pix">Pix</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_money" value="Dinheiro">
                            <label class="form-check-label" for="payment_money">Dinheiro</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_transfer" value="Transfer√™ncia banc√°ria">
                            <label class="form-check-label" for="payment_transfer">Transfer√™ncia banc√°ria</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_other_type" value="Outros">
                            <label class="form-check-label" for="payment_other_type">Outros:</label>
                            <input type="text" class="form-control-sm ml-2" id="other_payment" name="other_payment" style="width: 150px;">
                        </div>
                    </div>
                    
                    <div class="legal-highlight mt-3">
                        <strong>üìÖ Prazo para Reclama√ß√£o:</strong> Conforme CDC Art. 26
                        <div class="form-group mt-2">
                            <label for="complaint_period">Prazo para comunicar problemas (dias √∫teis):</label>
                            <select class="form-control" id="complaint_period" name="complaint_period">
                                <option value="5">5 dias √∫teis</option>
                                <option value="7">7 dias √∫teis</option>
                                <option value="10">10 dias √∫teis</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 5: Multa e Penalidades -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Cl√°usula 4 - Das Penalidades</h2>
                    <span class="badge bg-dark text-light legal-badge">Art. 408 CC</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>‚öñÔ∏è Multa por Inadimplemento</strong>
                        <p>Conforme C√≥digo Civil, Art. 408-410</p>
                    </div>
                    <div class="form-group">
                        <label for="penalty_percentage">Percentual da multa por descumprimento:</label>
                        <select class="form-control" id="penalty_percentage" name="penalty_percentage">
                            <option value="10">10% sobre o valor do contrato</option>
                            <option value="15">15% sobre o valor do contrato</option>
                            <option value="20">20% sobre o valor do contrato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="late_fee">Taxa de mora por atraso no pagamento (% ao m√™s):</label>
                        <select class="form-control" id="late_fee" name="late_fee">
                            <option value="1">1% ao m√™s</option>
                            <option value="2">2% ao m√™s</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 6: Garantia Detalhada -->
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h2>Cl√°usula 5 - Da Garantia</h2>
                    <span class="badge bg-light text-dark legal-badge">CDC Art. 26</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>üõ°Ô∏è Garantia Legal Ampliada</strong>
                        <p>Baseada no C√≥digo de Defesa do Consumidor</p>
                    </div>
                    <div class="form-group">
                        <label for="warranty_period">Per√≠odo de garantia:</label>
                        <select class="form-control" id="warranty_period" name="warranty_period">
                            <option value="90">90 dias (padr√£o)</option>
                            <option value="180">180 dias</option>
                            <option value="365">1 ano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>O que est√° coberto pela garantia:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_execution" name="warranty_coverage" value="Defeitos de execu√ß√£o" checked>
                            <label class="form-check-label" for="warranty_execution">Defeitos de execu√ß√£o</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_materials" name="warranty_coverage" value="Materiais defeituosos">
                            <label class="form-check-label" for="warranty_materials">Materiais defeituosos</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_installation" name="warranty_coverage" value="Problemas de instala√ß√£o">
                            <label class="form-check-label" for="warranty_installation">Problemas de instala√ß√£o</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>O que N√ÉO est√° coberto:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_misuse" name="warranty_exclusions" value="Mau uso" checked>
                            <label class="form-check-label" for="exclusion_misuse">Mau uso pelo cliente</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_third_party" name="warranty_exclusions" value="Interfer√™ncia de terceiros" checked>
                            <label class="form-check-label" for="exclusion_third_party">Interfer√™ncia de terceiros</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_electrical" name="warranty_exclusions" value="Problemas el√©tricos">
                            <label class="form-check-label" for="exclusion_electrical">Problemas el√©tricos externos</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 7: Limita√ß√£o de Responsabilidade -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h2>Cl√°usula 6 - Da Limita√ß√£o de Responsabilidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Jurisprud√™ncia</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>üõ°Ô∏è Prote√ß√£o Jur√≠dica</strong>
                        <p>Limita√ß√£o baseada em jurisprud√™ncia consolidada</p>
                    </div>
                    <div class="form-group">
                        <label>A contratada N√ÉO se responsabiliza por:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_electrical" name="liability_limitations" value="Falhas el√©tricas" checked>
                            <label class="form-check-label" for="limit_electrical">Falhas el√©tricas da rede local</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_structural" name="liability_limitations" value="Problemas estruturais" checked>
                            <label class="form-check-label" for="limit_structural">Problemas estruturais do im√≥vel</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_indirect" name="liability_limitations" value="Danos indiretos" checked>
                            <label class="form-check-label" for="limit_indirect">Danos indiretos ou lucros cessantes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_acts" name="liability_limitations" value="Atos de terceiros" checked>
                            <label class="form-check-label" for="limit_acts">Atos de terceiros n√£o autorizados</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 8: Confidencialidade -->
            <div class="card mt-4">
                <div class="card-header bg-secondary text-white">
                    <h2>Cl√°usula 7 - Da Confidencialidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Livre Pacto</span>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confidentiality_clause" name="confidentiality_clause" value="true">
                        <label class="form-check-label" for="confidentiality_clause">
                            <strong>Incluir cl√°usula de confidencialidade</strong><br>
                            <small class="text-muted">Prote√ß√£o de dados e informa√ß√µes sens√≠veis de ambas as partes</small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 9: Reajuste (para contratos longos) -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h2>Cl√°usula 8 - Do Reajuste</h2>
                    <span class="badge bg-light text-dark legal-badge">Lei 10.192/01</span>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="adjustment_clause" name="adjustment_clause" value="true">
                        <label class="form-check-label" for="adjustment_clause">
                            <strong>Incluir cl√°usula de reajuste anual</strong><br>
                            <small class="text-muted">Aplic√°vel apenas para contratos com dura√ß√£o superior a 12 meses</small>
                        </label>
                    </div>
                    <div class="form-group mt-2" id="adjustment_details" style="display: none;">
                        <label for="adjustment_index">√çndice de reajuste:</label>
                        <select class="form-control" id="adjustment_index" name="adjustment_index">
                            <option value="IPCA">IPCA (√çndice de Pre√ßos ao Consumidor Amplo)</option>
                            <option value="INPC">INPC (√çndice Nacional de Pre√ßos ao Consumidor)</option>
                            <option value="IGP-M">IGP-M (√çndice Geral de Pre√ßos do Mercado)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 10: Testemunhas -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Testemunhas</h2>
                    <span class="badge bg-dark text-light legal-badge">CPC Art. 784</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>‚öñÔ∏è Execu√ß√£o Judicial Facilitada</strong>
                        <p>Contrato com duas testemunhas permite execu√ß√£o mais r√°pida (CPC Art. 784, III)</p>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="include_witnesses" name="include_witnesses" value="true" checked>
                        <label class="form-check-label" for="include_witnesses">
                            <strong>Incluir campo para assinatura de testemunhas</strong><br>
                            <small class="text-muted">Facilita execu√ß√£o judicial em caso de descumprimento</small>
                        </label>
                    </div>
                    <div id="witnesses_details" class="mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Testemunha 1</h5>
                                <div class="form-group">
                                    <label for="witness1_name">Nome:</label>
                                    <input type="text" class="form-control" id="witness1_name" name="witness1_name">
                                </div>
                                <div class="form-group">
                                    <label for="witness1_cpf">CPF:</label>
                                    <input type="text" class="form-control" id="witness1_cpf" name="witness1_cpf">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Testemunha 2</h5>
                                <div class="form-group">
                                    <label for="witness2_name">Nome:</label>
                                    <input type="text" class="form-control" id="witness2_name" name="witness2_name">
                                </div>
                                <div class="form-group">
                                    <label for="witness2_cpf">CPF:</label>
                                    <input type="text" class="form-control" id="witness2_cpf" name="witness2_cpf">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 11: Termos e Condi√ß√µes -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Termos e Condi√ß√µes</h2>
                </div>
                <div class="card-body">
                    <p>As demais cl√°usulas (Responsabilidades, Rescis√£o e Condi√ß√µes Finais) est√£o definidas conforme a legisla√ß√£o brasileira vigente e ser√£o inclu√≠das no documento final.</p>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="agree_terms" name="agree_terms" required>
                        <label class="form-check-label" for="agree_terms">
                            <strong>Concordo com todos os termos e condi√ß√µes deste contrato juridicamente aprimorado</strong>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Bot√£o para gerar PDF -->
            <div class="mt-4 mb-4">
                <button type="button" id="generatePdfBtn" class="btn btn-success btn-lg">
                    üìÑ Gerar Contrato Juridicamente Aprimorado em PDF
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Controle dos campos de pagamento
            const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
            const installmentDetails = document.getElementById('installment_details');
            const downpaymentDetails = document.getElementById('downpayment_details');

            paymentMethods.forEach(method => {
                method.addEventListener('change', function() {
                    installmentDetails.classList.remove('active');
                    downpaymentDetails.classList.remove('active');

                    if (this.value === 'Parcelado') {
                        installmentDetails.classList.add('active');
                    } else if (this.value === 'Sinal') {
                        downpaymentDetails.classList.add('active');
                    }
                });
            });

            // Controle da cl√°usula de reajuste
            document.getElementById('adjustment_clause').addEventListener('change', function() {
                const adjustmentDetails = document.getElementById('adjustment_details');
                if (this.checked) {
                    adjustmentDetails.style.display = 'block';
                } else {
                    adjustmentDetails.style.display = 'none';
                }
            });

            // Controle das testemunhas
            document.getElementById('include_witnesses').addEventListener('change', function() {
                const witnessesDetails = document.getElementById('witnesses_details');
                if (this.checked) {
                    witnessesDetails.style.display = 'block';
                } else {
                    witnessesDetails.style.display = 'none';
                }
            });

            // Gerar PDF
            document.getElementById('generatePdfBtn').addEventListener('click', function() {
                const form = document.getElementById('contractForm');
                
                if (!form.checkValidity()) {
                    alert('Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }

                if (!document.getElementById('agree_terms').checked) {
                    alert('Voc√™ deve concordar com os termos e condi√ß√µes para gerar o contrato.');
                    return;
                }

                generatePDF();
            });

            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const maxWidth = pageWidth - (margin * 2);
                let currentY = margin;

                // Configura√ß√µes de estilo
                const styles = {
                    title: { fontSize: 16, fontStyle: 'bold', textColor: [0, 0, 0] },
                    subtitle: { fontSize: 14, fontStyle: 'bold', textColor: [0, 0, 0] },
                    sectionTitle: { fontSize: 12, fontStyle: 'bold', textColor: [13, 110, 253] },
                    normal: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] },
                    highlight: { fontSize: 10, fontStyle: 'bold', textColor: [0, 100, 0] },
                    legal: { fontSize: 9, fontStyle: 'italic', textColor: [100, 100, 100] }
                };

                // Fun√ß√£o para adicionar texto com quebra de linha autom√°tica
                // Fun√ß√£o para adicionar texto com quebra de linha autom√°tica
                function addText(text, style, isNewPage = false) {
                    if (isNewPage || currentY > pageHeight - 30) {
                        doc.addPage();
                        currentY = margin;
                    }
                    
                    doc.setFontSize(style.fontSize);
                    doc.setFont('helvetica', style.fontStyle);
                    doc.setTextColor(style.textColor[0], style.textColor[1], style.textColor[2]);
                    
                    const lines = doc.splitTextToSize(text, maxWidth);
                    lines.forEach(line => {
                        if (currentY > pageHeight - 20) {
                            doc.addPage();
                            currentY = margin;
                        }
                        doc.text(line, margin, currentY);
                        currentY += style.fontSize * 0.5;
                    });
                    currentY += 3;
                }

                // Fun√ß√£o para adicionar se√ß√£o
                function addSection(title, content, legalRef = '') {
                    addText(title + (legalRef ? ` (${legalRef})` : ''), styles.sectionTitle);
                    currentY += 2;
                    addText(content, styles.normal);
                    currentY += 5;
                }

                // Cabe√ßalho do contrato
                addText('CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS', styles.title);
                addText('RGS CLIMATIZA√á√ÉO', styles.subtitle);
                currentY += 5;

                // Dados das partes
                const clientName = document.getElementById('client_name').value;
                const clientCpfCnpj = document.getElementById('client_cpf_cnpj').value;
                const clientAddress = document.getElementById('client_address').value;
                const clientPhone = document.getElementById('client_phone').value;
                const clientEmail = document.getElementById('client_email').value;

                addSection('DADOS DAS PARTES', 
                    `CONTRATANTE: ${clientName}, CPF/CNPJ: ${clientCpfCnpj}, Endere√ßo: ${clientAddress}, Telefone: ${clientPhone}${clientEmail ? `, E-mail: ${clientEmail}` : ''}\n\n` +
                    'CONTRATADO: RGS Climatiza√ß√£o, Titular: Rodrigo Gon√ßalves de Souza, CNPJ: 61.038.796/0001-66, Endere√ßo: Rua Carij√≥s, 52, Filad√©lfia ‚Äì Te√≥filo Otoni/MG, Telefone: (33) 98827-3510, E-mail: rgs.climatizacao.to@gmail.com',
                    'Art. 104 CC'
                );

                // Objeto do contrato
                const services = [];
                document.querySelectorAll('input[name="services"]:checked').forEach(service => {
                    if (service.value === 'Outros' && document.getElementById('other_service').value) {
                        services.push(document.getElementById('other_service').value);
                    } else if (service.value !== 'Outros') {
                        services.push(service.value);
                    }
                });

                addSection('CL√ÅUSULA 1 - DO OBJETO',
                    `O presente contrato tem por objeto a presta√ß√£o dos seguintes servi√ßos relacionados a aparelhos de ar-condicionado: ${services.join(', ')}.`,
                    'Art. 593 CC'
                );

                // Local e prazo
                const serviceLocation = document.getElementById('service_location').value;
                const startDate = document.getElementById('start_date').value;
                const endDate = document.getElementById('end_date').value;

                addSection('CL√ÅUSULA 2 - DO LOCAL E PRAZO',
                    `Os servi√ßos ser√£o prestados no seguinte endere√ßo: ${serviceLocation}. Data de in√≠cio: ${new Date(startDate).toLocaleDateString('pt-BR')}. Data de t√©rmino prevista: ${new Date(endDate).toLocaleDateString('pt-BR')}.`,
                    'Art. 594 CC'
                );

                // Valor e pagamento
                const serviceValue = document.getElementById('service_value').value;
                const paymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
                const paymentType = document.querySelector('input[name="payment_type"]:checked').value;
                const complaintPeriod = document.getElementById('complaint_period').value;

                let paymentDetails = `Valor total: R$ ${parseFloat(serviceValue).toLocaleString('pt-BR', {minimumFractionDigits: 2})}. Forma de pagamento: ${paymentMethod}`;
                
                if (paymentMethod === 'Parcelado') {
                    const installments = document.getElementById('installments').value;
                    const installmentValue = document.getElementById('installment_value').value;
                    paymentDetails += ` em ${installments} vezes de R$ ${parseFloat(installmentValue).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                } else if (paymentMethod === 'Sinal') {
                    const downpayment = document.getElementById('downpayment').value;
                    paymentDetails += ` de R$ ${parseFloat(downpayment).toLocaleString('pt-BR', {minimumFractionDigits: 2})} na assinatura e o restante ap√≥s conclus√£o`;
                }
                
                paymentDetails += `. M√©todo de pagamento: ${paymentType}. Prazo para comunicar problemas: ${complaintPeriod} dias √∫teis.`;

                addSection('CL√ÅUSULA 3 - DO VALOR E FORMA DE PAGAMENTO', paymentDetails, 'Art. 315 CC');

                // Penalidades
                const penaltyPercentage = document.getElementById('penalty_percentage').value;
                const lateFee = document.getElementById('late_fee').value;

                addSection('CL√ÅUSULA 4 - DAS PENALIDADES',
                    `Em caso de descumprimento contratual, ser√° aplicada multa de ${penaltyPercentage}% sobre o valor do contrato. Para atraso no pagamento, ser√° cobrada taxa de mora de ${lateFee}% ao m√™s.`,
                    'Art. 408 CC'
                );

                // Garantia
                const warrantyPeriod = document.getElementById('warranty_period').value;
                const warrantyCoverage = [];
                document.querySelectorAll('input[name="warranty_coverage"]:checked').forEach(item => {
                    warrantyCoverage.push(item.value);
                });
                const warrantyExclusions = [];
                document.querySelectorAll('input[name="warranty_exclusions"]:checked').forEach(item => {
                    warrantyExclusions.push(item.value);
                });

                addSection('CL√ÅUSULA 5 - DA GARANTIA',
                    `A contratada oferece garantia de ${warrantyPeriod} dias para os servi√ßos prestados. Cobertura: ${warrantyCoverage.join(', ')}. Exclus√µes: ${warrantyExclusions.join(', ')}.`,
                    'CDC Art. 26'
                );

                // Limita√ß√£o de responsabilidade
                const liabilityLimitations = [];
                document.querySelectorAll('input[name="liability_limitations"]:checked').forEach(item => {
                    liabilityLimitations.push(item.value);
                });

                addSection('CL√ÅUSULA 6 - DA LIMITA√á√ÉO DE RESPONSABILIDADE',
                    `A contratada n√£o se responsabiliza por: ${liabilityLimitations.join(', ')}.`,
                    'Jurisprud√™ncia'
                );

                // Confidencialidade (se marcada)
                if (document.getElementById('confidentiality_clause').checked) {
                    addSection('CL√ÅUSULA 7 - DA CONFIDENCIALIDADE',
                        'As partes comprometem-se a manter sigilo sobre todas as informa√ß√µes confidenciais obtidas durante a execu√ß√£o deste contrato.',
                        'Livre Pacto'
                    );
                }

                // Reajuste (se marcado)
                if (document.getElementById('adjustment_clause').checked) {
                    const adjustmentIndex = document.getElementById('adjustment_index').value;
                    addSection('CL√ÅUSULA 8 - DO REAJUSTE',
                        `Para contratos com dura√ß√£o superior a 12 meses, os valores ser√£o reajustados anualmente com base no √≠ndice ${adjustmentIndex}.`,
                        'Lei 10.192/01'
                    );
                }

                // Cl√°usulas finais
                addSection('CL√ÅUSULA FINAL - DAS DISPOSI√á√ïES GERAIS',
                    'Este contrato √© regido pelas leis brasileiras. O foro da comarca de Te√≥filo Otoni/MG √© eleito para dirimir quaisquer controv√©rsias. As partes podem comunicar-se por e-mail, WhatsApp ou telefone para quest√µes relacionadas ao contrato.'
                );

                // Assinaturas
                currentY += 10;
                addText('Local e Data: Te√≥filo Otoni/MG, ' + new Date().toLocaleDateString('pt-BR'), styles.normal);
                currentY += 15;

                // Linha de assinatura do contratante
                doc.line(margin, currentY, margin + 70, currentY);
                currentY += 5;
                addText(`${clientName} (Contratante)`, styles.normal);
                currentY += 15;

                // Linha de assinatura do contratado
                doc.line(margin, currentY, margin + 70, currentY);
                currentY += 5;
                addText('Rodrigo Gon√ßalves de Souza (Contratado)', styles.normal);
                currentY += 10;

                // Testemunhas (se inclu√≠das)
                if (document.getElementById('include_witnesses').checked) {
                    const witness1Name = document.getElementById('witness1_name').value;
                    const witness1Cpf = document.getElementById('witness1_cpf').value;
                    const witness2Name = document.getElementById('witness2_name').value;
                    const witness2Cpf = document.getElementById('witness2_cpf').value;

                    addText('TESTEMUNHAS:', styles.subtitle);
                    currentY += 10;

                    // Testemunha 1
                    doc.line(margin, currentY, margin + 70, currentY);
                    currentY += 5;
                    addText(`${witness1Name || '_'.repeat(30)}`, styles.normal);
                    addText(`CPF: ${witness1Cpf || '_'.repeat(15)}`, styles.normal);
                    currentY += 10;

                    // Testemunha 2
                    doc.line(margin, currentY, margin + 70, currentY);
                    currentY += 5;
                    addText(`${witness2Name || '_'.repeat(30)}`, styles.normal);
                    addText(`CPF: ${witness2Cpf || '_'.repeat(15)}`, styles.normal);
                }

                // Salvar o PDF
                const fileName = `Contrato_RGS_${clientName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                alert('Contrato gerado com sucesso!');
            }
        });
    </script>
</body>
</html>
{% endblock %}