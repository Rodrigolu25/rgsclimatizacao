{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contrato de Presta√ß√£o de Servi√ßos - RGS Climatiza√ß√£o</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <style>
        .form-group {
            margin-bottom: 1rem;
        }

        .payment-details {
            margin-left: 20px;
            display: none;
        }

        .payment-details.active {
            display: block;
        }

        .legal-highlight {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 10px 0;
        }

        .card-header {
            position: relative;
        }

        .legal-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.8em;
        }

        .signature-line {
            border-top: 1px solid #000;
            width: 200px;
            margin-top: 50px;
        }

        .section-title {
            background-color: #f8f9fa;
            padding: 8px;
            border-left: 4px solid #0d6efd;
            margin-bottom: 15px;
        }

        .currency-input {
            position: relative;
        }

        .currency-input::before {
            content: "R$";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

        .currency-input input {
            padding-left: 30px;
        }

        .legal-reference {
            font-size: 0.8em;
            color: #666;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="alert alert-success" role="alert">
            <h4 class="alert-heading">‚úÖ Contrato Juridicamente Aprimorado</h4>
            <p>Este contrato foi atualizado com as melhorias previstas na legisla√ß√£o brasileira para maior seguran√ßa
                jur√≠dica.</p>
        </div>

        <h1 class="mt-4">Contrato de Presta√ß√£o de Servi√ßos - RGS Climatiza√ß√£o</h1>

        <!-- Formul√°rio principal -->
        <form id="contractForm">
            <!-- Se√ß√£o 1: Dados das Partes -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Dados das Partes</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 104 CC</span>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>Contratante</h3>
                            <div class="form-group">
                                <label for="client_name">Nome:</label>
                                <input type="text" class="form-control" id="client_name" name="client_name" required>
                            </div>
                            <div class="form-group">
                                <label for="client_cpf_cnpj">CPF/CNPJ:</label>
                                <input type="text" class="form-control" id="client_cpf_cnpj" name="client_cpf_cnpj"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="client_address">Endere√ßo:</label>
                                <input type="text" class="form-control" id="client_address" name="client_address"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="client_phone">Telefone:</label>
                                <input type="text" class="form-control" id="client_phone" name="client_phone" required>
                            </div>
                            <div class="form-group">
                                <label for="client_email">E-mail:</label>
                                <input type="email" class="form-control" id="client_email" name="client_email">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3>Contratado</h3>
                            <div class="form-group">
                                <label for="contractor_business_name">Nome Empresarial:</label>
                                <input type="text" class="form-control" id="contractor_business_name"
                                    name="contractor_business_name" value="RGS Climatiza√ß√£o" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_owner">Titular:</label>
                                <input type="text" class="form-control" id="contractor_owner" name="contractor_owner"
                                    value="Rodrigo Gon√ßalves de Souza" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_cnpj">CNPJ:</label>
                                <input type="text" class="form-control" id="contractor_cnpj" name="contractor_cnpj"
                                    value="61.038.796/0001-66" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_address">Endere√ßo:</label>
                                <input type="text" class="form-control" id="contractor_address"
                                    name="contractor_address" value="Rua Carij√≥s, 52, Filad√©lfia ‚Äì Te√≥filo Otoni/MG"
                                    readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_phone">Telefone:</label>
                                <input type="text" class="form-control" id="contractor_phone" name="contractor_phone"
                                    value="(33) 98827-3510" readonly>
                            </div>
                            <div class="form-group">
                                <label for="contractor_email">E-mail:</label>
                                <input type="email" class="form-control" id="contractor_email" name="contractor_email"
                                    value="rgs.climatizacao.to@gmail.com" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Objeto do Contrato -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 1 - Do Objeto</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 593 CC</span>
                </div>
                <div class="card-body">
                    <p>O presente contrato tem por objeto a presta√ß√£o dos seguintes servi√ßos relacionados a aparelhos de
                        ar-condicionado:</p>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_installation" name="services"
                            value="Instala√ß√£o" checked>
                        <label class="form-check-label" for="service_installation">Instala√ß√£o</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_preventive" name="services"
                            value="Manuten√ß√£o preventiva" checked>
                        <label class="form-check-label" for="service_preventive">Manuten√ß√£o preventiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_corrective" name="services"
                            value="Manuten√ß√£o corretiva" checked>
                        <label class="form-check-label" for="service_corrective">Manuten√ß√£o corretiva</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_cleaning" name="services"
                            value="Limpeza t√©cnica/higieniza√ß√£o" checked>
                        <label class="form-check-label" for="service_cleaning">Limpeza t√©cnica/higieniza√ß√£o</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="service_other" name="services"
                            value="Outros">
                        <label class="form-check-label" for="service_other">Outros:</label>
                        <input type="text" class="form-control mt-2" id="other_service" name="other_service">
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 3: Local e Prazo -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 2 - Do Local e Prazo</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 594 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="service_location">Local de presta√ß√£o dos servi√ßos:</label>
                        <input type="text" class="form-control" id="service_location" name="service_location"
                            value="Te√≥filo Otoni/MG" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="start_date">Data de in√≠cio:</label>
                                <input type="date" class="form-control" id="start_date" name="start_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="end_date">Data de t√©rmino prevista:</label>
                                <input type="date" class="form-control" id="end_date" name="end_date" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="renewal_clause" name="renewal_clause"
                            checked>
                        <label class="form-check-label" for="renewal_clause">Incluir cl√°usula de renova√ß√£o autom√°tica
                            por iguais per√≠odos sucessivos</label>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 4: Valor e Pagamento -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 3 - Do Valor e Forma de Pagamento</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 315 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group currency-input">
                        <label for="service_value">Valor total do servi√ßo:</label>
                        <input type="text" class="form-control" id="service_value" name="service_value" required>
                    </div>
                    <div class="form-group">
                        <label>Forma de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_cash"
                                value="√Ä vista" checked>
                            <label class="form-check-label" for="payment_cash">√Ä vista</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_installment"
                                value="Parcelado">
                            <label class="form-check-label" for="payment_installment">Parcelado</label>
                            <div class="payment-details" id="installment_details">
                                <label>em <input type="number" class="form-control-sm" id="installments"
                                        name="installments" min="2" max="12" style="width: 60px;"> vezes de R$ <input
                                        type="text" class="form-control-sm" id="installment_value"
                                        name="installment_value" style="width: 80px;"></label>
                            </div>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="payment_downpayment"
                                value="Sinal">
                            <label class="form-check-label" for="payment_downpayment">Sinal</label>
                            <div class="payment-details" id="downpayment_details">
                                <label>de R$ <input type="text" class="form-control-sm" id="downpayment"
                                        name="downpayment" style="width: 80px;"> na assinatura e o restante ap√≥s
                                    conclus√£o</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <label>M√©todo de pagamento:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_pix"
                                value="Pix" checked>
                            <label class="form-check-label" for="payment_pix">Pix</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_money"
                                value="Dinheiro">
                            <label class="form-check-label" for="payment_money">Dinheiro</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_transfer"
                                value="Transfer√™ncia banc√°ria">
                            <label class="form-check-label" for="payment_transfer">Transfer√™ncia banc√°ria</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_type" id="payment_other_type"
                                value="Outros">
                            <label class="form-check-label" for="payment_other_type">Outros:</label>
                            <input type="text" class="form-control-sm ml-2" id="other_payment" name="other_payment"
                                style="width: 150px;">
                        </div>
                    </div>

                    <div class="legal-highlight mt-3">
                        <strong>üìÖ Prazo para Reclama√ß√£o:</strong> Conforme CDC Art. 26
                        <div class="form-group mt-2">
                            <label for="complaint_period">Prazo para comunicar problemas (dias √∫teis):</label>
                            <select class="form-control" id="complaint_period" name="complaint_period">
                                <option value="5">5 dias √∫teis</option>
                                <option value="7">7 dias √∫teis</option>
                                <option value="10">10 dias √∫teis</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 5: Multa e Penalidades -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Cl√°usula 4 - Das Penalidades</h2>
                    <span class="badge bg-dark text-light legal-badge">Art. 408 CC</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>‚öñÔ∏è Multa por Inadimplemento</strong>
                        <p>Conforme C√≥digo Civil, Art. 408-410</p>
                    </div>
                    <div class="form-group">
                        <label for="penalty_percentage">Percentual da multa por descumprimento:</label>
                        <select class="form-control" id="penalty_percentage" name="penalty_percentage">
                            <option value="10">10% sobre o valor do contrato</option>
                            <option value="15">15% sobre o valor do contrato</option>
                            <option value="20">20% sobre o valor do contrato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="late_fee">Taxa de mora por atraso no pagamento (% ao m√™s):</label>
                        <select class="form-control" id="late_fee" name="late_fee">
                            <option value="1">1% ao m√™s</option>
                            <option value="2">2% ao m√™s</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attorney_fees">Honor√°rios advocat√≠cios em caso de cobran√ßa judicial:</label>
                        <select class="form-control" id="attorney_fees" name="attorney_fees">
                            <option value="10">10%</option>
                            <option value="20" selected>20%</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 6: Garantia Detalhada -->
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h2>Cl√°usula 5 - Da Garantia</h2>
                    <span class="badge bg-light text-dark legal-badge">CDC Art. 26</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>üõ°Ô∏è Garantia Legal Ampliada</strong>
                        <p>Baseada no C√≥digo de Defesa do Consumidor</p>
                    </div>
                    <div class="form-group">
                        <label for="warranty_period">Per√≠odo de garantia:</label>
                        <select class="form-control" id="warranty_period" name="warranty_period">
                            <option value="90">90 dias (padr√£o)</option>
                            <option value="180">180 dias</option>
                            <option value="365">1 ano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>O que est√° coberto pela garantia:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_execution"
                                name="warranty_coverage" value="Defeitos de execu√ß√£o" checked>
                            <label class="form-check-label" for="warranty_execution">Defeitos de execu√ß√£o</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_materials"
                                name="warranty_coverage" value="Materiais defeituosos" checked>
                            <label class="form-check-label" for="warranty_materials">Materiais defeituosos</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="warranty_installation"
                                name="warranty_coverage" value="Problemas de instala√ß√£o" checked>
                            <label class="form-check-label" for="warranty_installation">Problemas de instala√ß√£o</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>O que N√ÉO est√° coberto:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_misuse"
                                name="warranty_exclusions" value="Mau uso" checked>
                            <label class="form-check-label" for="exclusion_misuse">Mau uso pelo cliente</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_third_party"
                                name="warranty_exclusions" value="Interfer√™ncia de terceiros" checked>
                            <label class="form-check-label" for="exclusion_third_party">Interfer√™ncia de
                                terceiros</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exclusion_electrical"
                                name="warranty_exclusions" value="Problemas el√©tricos" checked>
                            <label class="form-check-label" for="exclusion_electrical">Problemas el√©tricos
                                externos</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 7: Limita√ß√£o de Responsabilidade -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h2>Cl√°usula 6 - Da Limita√ß√£o de Responsabilidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Jurisprud√™ncia</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>üõ°Ô∏è Prote√ß√£o Jur√≠dica</strong>
                        <p>Limita√ß√£o baseada em jurisprud√™ncia consolidada</p>
                    </div>
                    <div class="form-group">
                        <label>A contratada N√ÉO se responsabiliza por:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_electrical"
                                name="liability_limitations" value="Falhas el√©tricas" checked>
                            <label class="form-check-label" for="limit_electrical">Falhas el√©tricas da rede
                                local</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_structural"
                                name="liability_limitations" value="Problemas estruturais" checked>
                            <label class="form-check-label" for="limit_structural">Problemas estruturais do
                                im√≥vel</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_indirect"
                                name="liability_limitations" value="Danos indiretos" checked>
                            <label class="form-check-label" for="limit_indirect">Danos indiretos ou lucros
                                cessantes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="limit_acts" name="liability_limitations"
                                value="Atos de terceiros" checked>
                            <label class="form-check-label" for="limit_acts">Atos de terceiros n√£o autorizados</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 8: Confidencialidade -->
            <div class="card mt-4">
                <div class="card-header bg-secondary text-white">
                    <h2>Cl√°usula 7 - Da Confidencialidade</h2>
                    <span class="badge bg-light text-dark legal-badge">Livre Pacto</span>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confidentiality_clause"
                            name="confidentiality_clause" value="true" checked>
                        <label class="form-check-label" for="confidentiality_clause">
                            <strong>Incluir cl√°usula de confidencialidade</strong><br>
                            <small class="text-muted">Prote√ß√£o de dados e informa√ß√µes sens√≠veis de ambas as
                                partes</small>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 9: Rescis√£o -->
            <div class="card mt-4">
                <div class="card-header bg-dark text-white">
                    <h2>Cl√°usula 8 - Da Rescis√£o</h2>
                    <span class="badge bg-light text-dark legal-badge">Art. 473 CC</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="termination_notice">Prazo para comunica√ß√£o de rescis√£o (dias):</label>
                        <input type="number" class="form-control" id="termination_notice" name="termination_notice"
                            value="30">
                    </div>
                    <div class="form-group">
                        <label for="termination_penalty">Multa por rescis√£o unilateral injustificada:</label>
                        <select class="form-control" id="termination_penalty" name="termination_penalty">
                            <option value="20">20% do valor do contrato</option>
                            <option value="30">30% do valor do contrato</option>
                            <option value="50" selected>50% do valor dos servi√ßos n√£o executados</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="termination_settlement">Prazo para acerto de contas ap√≥s rescis√£o (dias):</label>
                        <input type="number" class="form-control" id="termination_settlement"
                            name="termination_settlement" value="10">
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 10: Disposi√ß√µes Gerais -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Cl√°usula 9 - Das Disposi√ß√µes Gerais</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="jurisdiction">Foro para resolu√ß√£o de disputas:</label>
                        <input type="text" class="form-control" id="jurisdiction" name="jurisdiction"
                            value="Te√≥filo Otoni/MG">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="successors_clause" name="successors_clause"
                            checked>
                        <label class="form-check-label" for="successors_clause">
                            O contrato obriga sucessores e herdeiros
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="written_modification"
                            name="written_modification" checked>
                        <label class="form-check-label" for="written_modification">
                            Altera√ß√µes devem ser feitas por escrito
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="official_communication"
                            name="official_communication" checked>
                        <label class="form-check-label" for="official_communication">
                            Comunica√ß√µes oficiais por e-mail ou correspond√™ncia com AR
                        </label>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 11: Testemunhas -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-dark">
                    <h2>Testemunhas</h2>
                    <span class="badge bg-dark text-light legal-badge">CPC Art. 784</span>
                </div>
                <div class="card-body">
                    <div class="legal-highlight">
                        <strong>‚öñÔ∏è Execu√ß√£o Judicial Facilitada</strong>
                        <p>Contrato com duas testemunhas permite execu√ß√£o mais r√°pida (CPC Art. 784, III)</p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Testemunha 1</h5>
                            <div class="form-group">
                                <label for="witness1_name">Nome:</label>
                                <input type="text" class="form-control" id="witness1_name" name="witness1_name"
                                    value="Rodrigo Souza">
                            </div>
                            <div class="form-group">
                                <label for="witness1_cpf">CPF:</label>
                                <input type="text" class="form-control" id="witness1_cpf" name="witness1_cpf"
                                    value="016.049.496-60">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>Testemunha 2</h5>
                            <div class="form-group">
                                <label for="witness2_name">Nome:</label>
                                <input type="text" class="form-control" id="witness2_name" name="witness2_name"
                                    value="Luciana Seixas de Almeida">
                            </div>
                            <div class="form-group">
                                <label for="witness2_cpf">CPF:</label>
                                <input type="text" class="form-control" id="witness2_cpf" name="witness2_cpf"
                                    value="054.960.656-40">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 12: Termos e Condi√ß√µes -->
            <div class="card mt-4">
                <div class="card-header bg-primary text-white">
                    <h2>Termos e Condi√ß√µes</h2>
                </div>
                <div class="card-body">
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="agree_terms" name="agree_terms" required>
                        <label class="form-check-label" for="agree_terms">
                            <strong>Concordo com todos os termos e condi√ß√µes deste contrato juridicamente
                                aprimorado</strong>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Bot√£o para gerar PDF -->
            <div class="mt-4 mb-4">
                <button type="button" id="generatePdfBtn" class="btn btn-success btn-lg">
                    üìÑ Gerar Contrato Juridicamente Aprimorado em PDF
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // M√°scaras para os campos
            $('#client_cpf_cnpj').mask('000.000.000-00', { reverse: true });
            $('#client_phone').mask('(00) 00000-0000');
            $('#witness1_cpf, #witness2_cpf').mask('000.000.000-00');

            // M√°scara para valores monet√°rios
            $('.currency-input input').mask('#.##0,00', { reverse: true });
            $('#installment_value, #downpayment').mask('#.##0,00', { reverse: true });

            // Configurar data inicial padr√£o para hoje
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = formattedDate;

            // Configurar data final padr√£o para 13 meses depois
            const endDate = new Date(today);
            endDate.setMonth(endDate.getMonth() + 13);
            const formattedEndDate = endDate.toISOString().split('T')[0];
            document.getElementById('end_date').value = formattedEndDate;

            // Controle dos campos de pagamento
            const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
            const installmentDetails = document.getElementById('installment_details');
            const downpaymentDetails = document.getElementById('downpayment_details');

            paymentMethods.forEach(method => {
                method.addEventListener('change', function () {
                    installmentDetails.classList.remove('active');
                    downpaymentDetails.classList.remove('active');

                    if (this.value === 'Parcelado') {
                        installmentDetails.classList.add('active');
                    } else if (this.value === 'Sinal') {
                        downpaymentDetails.classList.add('active');
                    }
                });
            });

            // Calcular valor da parcela quando o n√∫mero de parcelas ou valor total mudar
            $('#installments, #service_value').on('change', function () {
                const totalValue = parseFloat($('#service_value').val().replace('.', '').replace(',', '.'));
                const installments = parseInt($('#installments').val());

                if (totalValue && installments) {
                    const installmentValue = totalValue / installments;
                    $('#installment_value').val(installmentValue.toFixed(2).replace('.', ','));
                }
            });

            // Gerar PDF
            document.getElementById('generatePdfBtn').addEventListener('click', function () {
                const form = document.getElementById('contractForm');

                if (!form.checkValidity()) {
                    alert('Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }

                if (!document.getElementById('agree_terms').checked) {
                    alert('Voc√™ deve concordar com os termos e condi√ß√µes para gerar o contrato.');
                    return;
                }

                generatePDF();
            });

            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');

                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 15;
                const maxWidth = pageWidth - (margin * 2);
                let currentY = margin;

                // Configura√ß√µes de estilo
                const styles = {
                    title: { fontSize: 16, fontStyle: 'bold', textColor: [0, 0, 0] },
                    subtitle: { fontSize: 14, fontStyle: 'bold', textColor: [0, 0, 0] },
                    sectionTitle: { fontSize: 12, fontStyle: 'bold', textColor: [13, 110, 253] },
                    normal: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] },
                    highlight: { fontSize: 10, fontStyle: 'bold', textColor: [0, 100, 0] },
                    legal: { fontSize: 9, fontStyle: 'italic', textColor: [100, 100, 100] },
                    center: { fontSize: 10, fontStyle: 'normal', textColor: [0, 0, 0] }
                };

                // Fun√ß√£o para adicionar texto com quebra de linha autom√°tica
                function addText(text, style, isNewPage = false, isCenter = false) {
                    if (isNewPage || currentY > pageHeight - 30) {
                        doc.addPage();
                        currentY = margin;
                    }

                    doc.setFontSize(style.fontSize);
                    doc.setFont('helvetica', style.fontStyle);
                    doc.setTextColor(style.textColor[0], style.textColor[1], style.textColor[2]);

                    const lines = doc.splitTextToSize(text, maxWidth);
                    lines.forEach(line => {
                        if (currentY > pageHeight - 20) {
                            doc.addPage();
                            currentY = margin;
                        }

                        const xPosition = isCenter ? pageWidth / 2 : margin;
                        const alignment = isCenter ? 'center' : 'left';
                        doc.text(line, xPosition, currentY, { align: alignment });
                        currentY += style.fontSize * 0.5;
                    });
                    currentY += 3;
                }

                // Fun√ß√£o para adicionar se√ß√£o
                function addSection(title, content, legalRef = '') {
                    addText(title + (legalRef ? ` (${legalRef})` : ''), styles.sectionTitle);
                    currentY += 2;
                    addText(content, styles.normal);
                    currentY += 5;
                }

                // Cabe√ßalho do contrato
                addText('CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS', styles.title, false, true);
                addText('RGS CLIMATIZA√á√ÉO', styles.subtitle, false, true);
                currentY += 5;

                // Dados das partes
                const clientName = document.getElementById('client_name')?.value || '[NOME DO CLIENTE]';
                const clientCpfCnpj = document.getElementById('client_cpf_cnpj')?.value || '[CPF/CNPJ]';
                const clientAddress = document.getElementById('client_address')?.value || '[ENDERE√áO]';
                const clientPhone = document.getElementById('client_phone')?.value || '[TELEFONE]';
                const clientEmail = document.getElementById('client_email')?.value || '';

                addSection('DADOS DAS PARTES',
                    `CONTRATANTE: ${clientName}, CPF/CNPJ: ${clientCpfCnpj}, Endere√ßo: ${clientAddress}, Telefone: ${clientPhone}${clientEmail ? ', E-mail: ' + clientEmail : ''}\n\n` +
                    `CONTRATADO: RGS Climatiza√ß√£o, Titular: Rodrigo Gon√ßalves de Souza, CNPJ: 61.038.796/0001-66, Endere√ßo: Rua Carij√≥s, 52, Filad√©lfia ‚Äì Te√≥filo Otoni/MG, Telefone: (33) 98827-3510, E-mail: rgs.climatizacao.to@gmail.com`,
                    'Art. 104 CC');

                // Objeto do contrato
                const services = [];
                const serviceElements = document.querySelectorAll('input[name="services"]:checked');
                serviceElements.forEach(service => {
                    if (service.value === 'Outros' && document.getElementById('other_service')?.value) {
                        services.push(document.getElementById('other_service').value);
                    } else if (service.value !== 'Outros') {
                        services.push(service.value);
                    }
                });

                if (services.length === 0) {
                    services.push('[SERVI√áOS A SEREM DEFINIDOS]');
                }

                addSection('CL√ÅUSULA PRIMEIRA - DO OBJETO',
                    `O presente contrato tem por objeto a presta√ß√£o de servi√ßos t√©cnicos relacionados a aparelhos de ar-condicionado, compreendendo os seguintes servi√ßos:\n\n` +
                    services.map((service, index) => `${String.fromCharCode(97 + index)}) ${service}`).join('\n'),
                    'Art. 593 CC');

                // Local e prazo
                const serviceLocation = document.getElementById('service_location')?.value || '[LOCAL]';
                const startDate = document.getElementById('start_date')?.value || new Date().toISOString().split('T')[0];
                const endDate = document.getElementById('end_date')?.value || new Date().toISOString().split('T')[0];
                const renewalClause = document.getElementById('renewal_clause')?.checked || false;

                const startDateFormatted = new Date(startDate).toLocaleDateString('pt-BR');
                const endDateFormatted = new Date(endDate).toLocaleDateString('pt-BR');

                addSection('CL√ÅUSULA SEGUNDA - DO LOCAL E PRAZO DE EXECU√á√ÉO',
                    `1. Os servi√ßos ser√£o executados no munic√≠pio de ${serviceLocation}, podendo ser realizados em outros locais mediante pr√©via concord√¢ncia por escrito entre as partes.\n\n` +
                    `2. O in√≠cio da execu√ß√£o dos servi√ßos ser√° em ${startDateFormatted}, com t√©rmino previsto para ${endDateFormatted}` +
                    (renewalClause ? ', podendo ser renovado por m√∫tuo acordo, mediante Termo Aditivo.' : '.') + '\n\n' +
                    `3. O presente contrato poder√° ser prorrogado mediante acordo expresso entre as partes, formalizado por meio de Termo Aditivo.`,
                    'Art. 594 CC');

                // Valor e pagamento
                const serviceValue = document.getElementById('service_value')?.value || '[VALOR]';
                const paymentMethodEl = document.querySelector('input[name="payment_method"]:checked');
                const paymentTypeEl = document.querySelector('input[name="payment_type"]:checked');
                const complaintPeriod = document.getElementById('complaint_period')?.value || '7';

                const paymentMethod = paymentMethodEl ? paymentMethodEl.value : '√Ä vista';
                const paymentType = paymentTypeEl ? paymentTypeEl.value : 'Dinheiro';

                let paymentDetails = `1. O valor total dos servi√ßos ora contratados √© de R$ ${serviceValue}.\n\n`;

                if (paymentMethod === '√Ä vista') {
                    paymentDetails += `2. O pagamento ser√° efetuado √† vista`;
                } else if (paymentMethod === 'Parcelado') {
                    const installments = document.getElementById('installments')?.value || '[PARCELAS]';
                    const installmentValue = document.getElementById('installment_value')?.value || '[VALOR PARCELA]';
                    paymentDetails += `2. O pagamento ser√° efetuado parcelado em ${installments} vezes de R$ ${installmentValue}`;
                } else if (paymentMethod === 'Sinal') {
                    const downpayment = document.getElementById('downpayment')?.value || '[SINAL]';
                    paymentDetails += `2. O pagamento ser√° efetuado com sinal de R$ ${downpayment} na assinatura e o restante ap√≥s conclus√£o`;
                }

                if (paymentType === 'Pix') {
                    paymentDetails += `, por meio de transfer√™ncia via Pix, para a conta informada pelo Contratado.\n\n`;
                } else if (paymentType === 'Outros') {
                    const otherPayment = document.getElementById('other_payment')?.value || '[FORMA DE PAGAMENTO]';
                    paymentDetails += `, por meio de ${otherPayment}.\n\n`;
                } else {
                    paymentDetails += `, por meio de ${paymentType}.\n\n`;
                }

                paymentDetails += `3. O prazo m√°ximo para comunica√ß√£o de eventuais problemas ou defeitos detectados na execu√ß√£o dos servi√ßos √© de ${complaintPeriod} dias √∫teis ap√≥s sua conclus√£o.\n\n`;
                paymentDetails += `4. Os valores poder√£o ser reajustados anualmente pelo √çndice Nacional de Pre√ßos ao Consumidor Amplo (IPCA), ou na falta deste, por √≠ndice que o substitua.`;

                addSection('CL√ÅUSULA TERCEIRA - DO VALOR E FORMA DE PAGAMENTO', paymentDetails, 'Art. 315 CC / Lei 10.192/01');

                // Penalidades
                const penaltyPercentage = document.getElementById('penalty_percentage')?.value || '10';
                const lateFee = document.getElementById('late_fee')?.value || '2';

                addSection('CL√ÅUSULA QUARTA - DAS PENALIDADES',
                    `1. Em caso de descumprimento de qualquer obriga√ß√£o estabelecida neste contrato, aplicar-se-√° multa de ${penaltyPercentage}% sobre o valor total pactuado, independentemente de outras san√ß√µes legais.\n\n` +
                    `2. Caso o Contratante atrase o pagamento, incidir√° taxa de mora de ${lateFee}% ao m√™s sobre o valor devido, sem preju√≠zo da cobran√ßa judicial, se necess√°rio.\n\n` +
                    `3. A aplica√ß√£o das penalidades previstas nesta cl√°usula n√£o exime as partes do cumprimento de suas obriga√ß√µes contratuais.`,
                    'Art. 408 CC');

                // Garantia
                const warrantyPeriod = document.getElementById('warranty_period')?.value || '90';
                const warrantyCoverage = [];
                const warrantyCoverageElements = document.querySelectorAll('input[name="warranty_coverage"]:checked');
                warrantyCoverageElements.forEach(item => {
                    warrantyCoverage.push(item.value);
                });

                const warrantyExclusions = [];
                const warrantyExclusionsElements = document.querySelectorAll('input[name="warranty_exclusions"]:checked');
                warrantyExclusionsElements.forEach(item => {
                    warrantyExclusions.push(item.value);
                });

                if (warrantyCoverage.length === 0) {
                    warrantyCoverage.push('Servi√ßos executados conforme especifica√ß√£o t√©cnica');
                }
                if (warrantyExclusions.length === 0) {
                    warrantyExclusions.push('Danos decorrentes de mau uso ou neglig√™ncia');
                }

                addSection('CL√ÅUSULA QUINTA - DA GARANTIA',
                    `1. O Contratado oferece garantia de ${warrantyPeriod} dias contados da data de conclus√£o dos servi√ßos, responsabilizando-se pelos v√≠cios e defeitos decorrentes da execu√ß√£o.\n\n` +
                    `2. A garantia cobre especificamente:\n` +
                    warrantyCoverage.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `3. Ficam expressamente exclu√≠dos da garantia:\n` +
                    warrantyExclusions.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `4. Para fazer valer a garantia, o Contratante dever√° comunicar os defeitos por escrito, dentro do prazo estabelecido no item 1.`,
                    'CDC Art. 26');

                // Limita√ß√£o de responsabilidade
                const liabilityLimitations = [];
                const liabilityElements = document.querySelectorAll('input[name="liability_limitations"]:checked');
                liabilityElements.forEach(item => {
                    liabilityLimitations.push(item.value);
                });

                if (liabilityLimitations.length === 0) {
                    liabilityLimitations.push('Danos indiretos ou lucros cessantes');
                }

                addSection('CL√ÅUSULA SEXTA - DA LIMITA√á√ÉO DE RESPONSABILIDADE',
                    `1. O Contratado n√£o se responsabiliza por:\n\n` +
                    liabilityLimitations.map((item, index) => `${String.fromCharCode(97 + index)}) ${item};`).join('\n') + '\n\n' +
                    `2. A limita√ß√£o de responsabilidade prevista nesta cl√°usula n√£o se aplica aos casos de dolo ou culpa grave do Contratado.\n\n` +
                    `3. O Contratado se compromete a executar os servi√ßos com a dilig√™ncia e t√©cnica adequadas, observando as normas de seguran√ßa aplic√°veis.`,
                    'Art. 944 CC / Jurisprud√™ncia');

                // Confidencialidade
                const confidentialityClause = document.getElementById('confidentiality_clause')?.checked || false;
                if (confidentialityClause) {
                    addSection('CL√ÅUSULA S√âTIMA - DA CONFIDENCIALIDADE',
                        `1. As partes comprometem-se a manter sigilo absoluto sobre todas as informa√ß√µes trocadas durante a vig√™ncia deste contrato, especialmente aquelas que sejam consideradas confidenciais ou estrat√©gicas.\n\n` +
                        `2. A obriga√ß√£o de confidencialidade permanece v√°lida mesmo ap√≥s o t√©rmino do presente contrato.\n\n` +
                        `3. O descumprimento desta cl√°usula sujeitar√° a parte infratora ao pagamento de indeniza√ß√£o por danos morais e materiais.`,
                        'Art. 421 CC / Livre Pactua√ß√£o');
                }

                // Rescis√£o
                const terminationNotice = document.getElementById('termination_notice')?.value || '30';
                const terminationPenalty = document.getElementById('termination_penalty')?.value || '10';

                addSection('CL√ÅUSULA OITAVA - DA RESCIS√ÉO',
                    `1. Este contrato poder√° ser rescindido antecipadamente nas seguintes hip√≥teses:\n\n` +
                    `a) Por descumprimento de qualquer cl√°usula essencial deste contrato;\n` +
                    `b) Por m√∫tuo acordo entre as partes, mediante Termo Aditivo espec√≠fico;\n` +
                    `c) Por impossibilidade superveniente de cumprimento das obriga√ß√µes contratuais;\n` +
                    `d) Por fal√™ncia, concordata, dissolu√ß√£o ou liquida√ß√£o de qualquer das partes;\n` +
                    `e) Por for√ßa maior ou caso fortuito que impossibilite a continuidade da rela√ß√£o contratual.\n\n` +
                    `2. Na hip√≥tese de rescis√£o por descumprimento contratual, a parte inadimplente pagar√° √† outra indeniza√ß√£o correspondente aos preju√≠zos efetivamente sofridos.\n\n` +
                    `3. Em caso de rescis√£o unilateral imotivada, a parte que der causa pagar√° indeniza√ß√£o proporcional pelos servi√ßos j√° realizados e despesas incorridas.\n\n` +
                    `4. A rescis√£o n√£o exime as partes do cumprimento das obriga√ß√µes vencidas at√© a data da extin√ß√£o do contrato.`,
                    'Art. 473 e 475 CC');

                // Disposi√ß√µes gerais
                const jurisdiction = document.getElementById('jurisdiction')?.value || 'Te√≥filo Otoni/MG';
                addSection('CL√ÅUSULA NONA - DAS DISPOSI√á√ïES GERAIS',
                    `1. Este contrato entra em vigor na data de sua assinatura e produz efeitos por todo o per√≠odo pactuado, vinculando as partes e seus sucessores a t√≠tulo universal.\n\n` +
                    `2. Qualquer altera√ß√£o ou modifica√ß√£o deste contrato dever√° ser feita por escrito, mediante Termo Aditivo assinado por ambas as partes.\n\n` +
                    `3. As comunica√ß√µes entre as partes poder√£o ocorrer por meio de e-mail, WhatsApp, telefone ou correspond√™ncia registrada, utilizando-se os dados de contato constantes no pre√¢mbulo deste instrumento.\n\n` +
                    `4. O presente contrato obriga n√£o s√≥ as partes que o subscrevem, como tamb√©m seus herdeiros e sucessores.\n\n` +
                    `5. Se qualquer disposi√ß√£o deste contrato for considerada inv√°lida ou inexequ√≠vel, as demais cl√°usulas permanecer√£o em pleno vigor.\n\n` +
                    `6. Este contrato √© regido pelas leis brasileiras, especialmente pelo C√≥digo Civil e C√≥digo de Defesa do Consumidor, quando aplic√°vel.\n\n` +
                    `7. As partes elegem o foro da comarca de ${jurisdiction} para dirimir quaisquer quest√µes oriundas deste contrato, com ren√∫ncia expressa a qualquer outro, por mais privilegiado que seja.`,
                    'Art. 104 e 421 CC');

                // *** FOR√áA A SEGUNDA P√ÅGINA AQUI ***
                // Adiciona nova p√°gina para as assinaturas e testemunhas
                doc.addPage();
                currentY = margin;
                
                // Testemunhas na segunda p√°gina
                const witness1Name = document.getElementById('witness1_name')?.value || '[NOME TESTEMUNHA 1]';
                const witness1Cpf = document.getElementById('witness1_cpf')?.value || '[CPF TESTEMUNHA 1]';
                const witness2Name = document.getElementById('witness2_name')?.value || '[NOME TESTEMUNHA 2]';
                const witness2Cpf = document.getElementById('witness2_cpf')?.value || '[CPF TESTEMUNHA 2]';

                addSection('TESTEMUNHAS',
                    `___________________________________________________________\n` +
                    `1¬™ Testemunha: ${witness1Name}, CPF: ${witness1Cpf}\n` +
                    `Assinatura\n\n\n` +
                    `___________________________________________________________\n` +
                    `2¬™ Testemunha: ${witness2Name}, CPF: ${witness2Cpf}\n` +
                    `Assinatura`,
                    'CPC Art. 784');
                

                // Data e local na segunda p√°gina
                const today = new Date().toLocaleDateString('pt-BR');
                addText(`${serviceLocation}, ${today}`, styles.normal);
                currentY += 10;

                // Linhas de assinatura do CONTRATANTE e CONTRATADO na segunda p√°gina
                addText('_'.repeat(50), styles.normal, false, true);
                addText('CONTRATANTE', styles.normal, false, true);
                currentY += 15;

                addText('_'.repeat(50), styles.normal, false, true);
                addText('CONTRATADO - RGS Climatiza√ß√£o', styles.normal, false, true);
                addText('Rodrigo Gon√ßalves de Souza', styles.normal, false, true);
                currentY += 20;

                

                // Salvar PDF
                const fileName = `Contrato_RGS_${clientName.replace(/\s+/g, '_')}_${today.replace(/\//g, '-')}.pdf`;
                doc.save(fileName);

                alert('‚úÖ Contrato gerado com sucesso!');
            }
        });
    </script>
</body>

</html>
{% endblock %}